<!DOCTYPE html>
<html>
	<head>
		<script type="text/javascript" src="js/d3.v2.min.js"></script>
		<style type="text/css">
          .small { font-size: 10px; font-family: arial; }
          .sel { }
        </style>
	<head>
	<body>
		<div id="viz" style="width:850px; margin:auto"></div>
		<script type="text/javascript">
          var label_width = 200;
          var plot_width  = 600;
          var plot_margin_right = 100;
          var plot_margin_bottom = 5;
          var max_width = label_width + plot_width + plot_margin_right;
          var bar_height = 10;
          var bolt_time  = 9.69;
          
          //var all_but_bolt = [735.0253807,727.0516717,739.0243902,691.5662651,707.2580645,679.8798799,581.4634146,652.8827038,622.4852071,563.1067961,30];
          var data_points = [{"label":1990,"value":239,"unit":"runs"},{"label":1991,"value":417,"unit":"runs"},{"label":1992,"value":704,"unit":"runs"},{"label":1993,"value":319,"unit":"runs"},{"label":1994,"value":1089,"unit":"runs"},{"label":1995,"value":444,"unit":"runs"},{"label":1996,"value":1611,"unit":"runs"},{"label":1997,"value":1011,"unit":"runs"},{"label":1998,"value":1894,"unit":"runs"},{"label":1999,"value":843,"unit":"runs"},{"label":2000,"value":1328,"unit":"runs"},{"label":2001,"value":904,"unit":"runs"},{"label":2002,"value":741,"unit":"runs"},{"label":2003,"value":1141,"unit":"runs"},{"label":2004,"value":812,"unit":"runs"},{"label":2005,"value":412,"unit":"runs"},{"label":2006,"value":628,"unit":"runs"},{"label":2007,"value":1425,"unit":"runs"},{"label":2008,"value":460,"unit":"runs"},{"label":2009,"value":972,"unit":"runs"},{"label":2010,"value":204,"unit":"runs"},{"label":2011,"value":513,"unit":"runs"},{"label":2012,"value":315,"unit":"runs"}];
          // var data_points = [
          //     {label:"alpha", value:100, unit: 'ms'},
          //     {label:"beta", value:200, unit: 'ms'},
          //     {label:"gamma", value:300, unit: 'ms'},
          //     {label:"alpha", value:100, unit: 'ms'},
          //     {label:"beta", value:200, unit: 'ms'},
          //     {label:"gamma", value:300, unit: 'ms'},
          //     {label:"alpha", value:100, unit: 'ms'},
          //     {label:"beta", value:200, unit: 'ms'},
          //     {label:"gamma", value:300, unit: 'ms'},
          //     {label:"alpha", value:100, unit: 'ms'},
          // ];
          var max_height = (data_points.length * bar_height) + plot_margin_bottom;
          var total_time = 0;
          var width_per_sec = 0;
          for(var i = 0; i < data_points.length; i++) {
              total_time += data_points[i].value;
          }

          width_per_sec = plot_width / total_time;
          
          function get_x(data, index) {
              var x = label_width;
              if (index > 0) {
                  //x coordinate for nth element =
                  //(width of the (n-1)th element) + 1
                  for (var j = 0; j < index; j++) {
                      var time = data_points[j].value;
                      x += time * width_per_sec;
                  }
              }
              return x;
          }

          //our 'canvas'
          var svg = d3.select("#viz")
          .append("svg")
          .attr("width", max_width)
          .attr("height", max_height);

          //y axis
          svg.append("line")
          .attr("x1", label_width - 0.5)
          .attr("y1", 0)
          .attr("x2", label_width - 0.5)
          .attr("y2", function() { return data_points.length * bar_height })
          .attr("stroke", "black");

          //x axis
          svg.append("line")
          .attr("x1", label_width - 1)
          .attr("y1", function() { return data_points.length * bar_height - 0.5 })
          .attr("x2", plot_width + label_width)
          .attr("y2", function() { return data_points.length * bar_height - 0.5 })
          .attr("stroke", "black");

                
          //the y-axis labels
          svg.selectAll("label")
          .data(data_points)
          .enter().append("text")
          .text(function(d) { return d.label })
          .attr("x", 195)
          .attr("y", function(d, i) { return (i * bar_height) + bar_height})
          .attr("dy", -2)
          .attr("class", "small")
          .attr("text-anchor", "end")

          //the bars
          svg.selectAll("waterfall")
          .data(data_points)
          .enter().append("rect")
          .attr("x", function(d, i) { return get_x(d, i); })
          .attr("y", function(d, i) { return i * bar_height; })
          .attr("height", bar_height)
          .attr("fill", "#3333")
          .attr("width", function(d) { return d.value * width_per_sec; })
          .attr("class", "sel")
          .attr("value", function(d) { return d.value; })

          //the bar labels
          svg.selectAll("label")
          .data(data_points)
          .enter().append("svg:text")
          .text(function(d) { return d.value + (d.unit ? d.unit : 'ms') })
          .attr("x", function(d, i) { return get_x(d, i) + d.value * width_per_sec + 2 })
          .attr("y", function(d, i) { return (i * bar_height) + bar_height })
          .attr("dy", -2)
          .attr("class", "small")

		</script>
	</body>
</html>
